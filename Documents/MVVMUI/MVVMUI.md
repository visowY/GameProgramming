# <center>MVVMUI框架解析</center>


## 动态数据集合：

* 定义：当集合添加，删除项目或者重置时，提供一种通讯机制，告诉UI动态更新界面。

* 要点： 数据驱动界面

## IOC工厂理念

* 工厂的动机： 对对象的创建和释放进行管理，提高效率。

* 工厂的分类： Singleton， Transient, Pool 

## 实现对象的注入（Service Locator）服务定位模式

*  什么叫做依赖注入？什么叫做服务定位模式？

## 构建统一的Repository

* 封装了对数据的访问和持久化。
* 目的通过统一的接口实现对不同存储介质的访问。
* 实现对数据的增删查改

* 具体数据获取方式分类：
    1. TextAssets
    2. PlayerPrefs
    3. FileSystemRepository(访问和持久化一些日志相关的消息)
    4. MemoryRepository(高速缓存一些临时数据)
    5. 操作关系型数据库sqlite
    6. 以webService访问和持久化远程数据

## 协程和多线程

* 线程启动
* 线程终止
* 共享数据处理
* Dispatcher 的引入

## 网络层的构建

* 使用token（令牌）验证身份
    1. 代表了唯一的身份验证令牌
    2. 具有时效性。

## 解释器的实现

* 对特定的语法作出合理的解释。

* 作用： 解释自定义的公式。（BNF范式）


## AOP思想的实践（面向切面编程的引入）

* 目的 不侵入业务代码跟踪日志
* 应用场景：为日志记录，性能监控，安全控制，事务处理，异常处理等与具体业务逻辑无关，却又需要在全局范围内执行的功能提供良好的重用和业务逻辑解耦
* 核心理念： 对目标对象的某种操作进行拦截，在系统的其他部分调用目标对象的某种操作时拦截这些调用，并在真正调用前后执行一段中间逻辑。
* 实现方式
    1. 静态织入：通过扩展编译器对代码的中间语言IL插入代码
    2. 动态织入： 在运行时创建动态代理来拦截。
* 代理模式的使用
* 装饰器模式的使用
* 总结：AOP思想是非常重要的重构手段，以不侵入的形式解耦业务逻辑和拦截方法。本质上是以横向扩展的形式替换了纵向继承方式来实现。


## C# 使用Emit实现动态aop框架
>Emit含义为发出、产生的含义，这是.NET中的一组类库，命名空间为System.Reflection.Emit，几乎所有的.NET版本(Framework/Mono/NetCore)都支持Emit,可以实现用C#代码生成代码的类库

>Emit的本质 我们知道.NET可以由各种语言进行编写，比如VB,C++等，当然绝大部分程序员进行.NET开发都是使用C#语言进行的，这些语言都会被各自的语言解释器解释为IL语言并执行，而Emit类库的作用就是用这些语言来编写生成IL语言，并交给CLR(公共语言运行时)进行执行。

* Emit  的使用场景：
    1.运行中动态的创建类型，模块等，同时又需要提高效率。
    2.延迟绑定对象的使用。
    3.工具插件以及IDE的开发等。
    4.ORM的实现。
    5.减少反射的性能损失。






### 具体实现：



## 日志组件的实施

* 日志存储的分类：
    1. 控制台：     本地开发时使用，记录数据和跟踪执行过程
    2. 文件系统：   用来监控执行实践，进行性能分析，如果用户同意，则将日志传输到服务器上。
    3. 数据库：     记录异常日志，crash之后的行为，每次用户登陆时，传输到服务器。
    4. 第三方平台：  友盟等。应用闪退时，Crash原因会记录在友盟中，通过DashBoard查看。

* 日志组件的设计：

* 使用到了模版方法模式：在方法定义算法骨架，将一些步骤延时到子类。模版方法在不改变算法的结构下，重新定义了算法中的某些步骤。

* 批量写入数据，提高吞吐率。




